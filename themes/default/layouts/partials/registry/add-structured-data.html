{{ $content := .Content }}
{{ $page := .Page }}

{{/* Extract metadata from page parameters */}}
{{ $titleTag := $page.Params.title_tag | default "" }}
{{ $packageName := "azure-native" }}
{{ $serviceName := "" }}
{{ $resourceName := "" }}

{{ if $titleTag }}
  {{ $parts := split $titleTag "." }}
  {{ if ge (len $parts) 3 }}
    {{ $packageName = index $parts 0 }}
    {{ $serviceName = index $parts 1 }}
    {{ $resourceName = index $parts 2 }}
  {{ end }}
{{ end }}

{{/* Format service and resource names for display */}}
{{ $serviceDisplay := $serviceName | humanize | title }}
{{ $resourceDisplay := $resourceName | humanize | title }}

{{/* Language mapping */}}
{{ $languages := dict "typescript" "TypeScript" "python" "Python" "go" "Go" "csharp" "C#" "java" "Java" "yaml" "YAML" }}

{{/* Process the content to add structured data */}}
{{ $processed := $content }}

{{ range $langCode, $langName := $languages }}
  {{/* Find pulumi-choosable blocks for this language and wrap with structured data */}}
  {{ $searchStart := printf `<pulumi-choosable type="language" values="%s">` $langCode }}
  {{ $searchEnd := `</pulumi-choosable>` }}
  
  {{/* Build the structured data wrapper */}}
  {{ $structuredDataStart := printf `<pulumi-choosable type="language" values="%s">
<div itemscope itemtype="https://schema.org/SoftwareSourceCode">
    <meta itemprop="name" content="Azure %s %s - %s Example" />
    <meta itemprop="description" content="Pulumi %s code example for creating and managing Azure %s %s resources using Infrastructure as Code" />
    <meta itemprop="programmingLanguage" content="%s" />
    <meta itemprop="codeSampleType" content="code snippet" />
    <meta itemprop="keywords" content="Azure, %s, %s, Pulumi, Infrastructure as Code, IaC, %s, Cloud, DevOps" />
    <meta itemprop="runtimePlatform" content="Microsoft Azure" />
    <meta itemprop="targetProduct" content="Pulumi Infrastructure as Code Platform" />
    <meta itemprop="codeRepository" content="https://github.com/pulumi/pulumi-%s" />
    <meta itemprop="license" content="https://github.com/pulumi/pulumi-%s/blob/master/LICENSE" />
    <meta itemprop="author" content="Pulumi" />
    <div itemprop="text">` $langCode $serviceDisplay $resourceDisplay $langName $langName $serviceDisplay $resourceDisplay $langName $serviceDisplay $resourceDisplay $langName $packageName $packageName }}
  
  {{ $structuredDataEnd := `    </div>
</div>
</pulumi-choosable>` }}
  
  {{/* Replace the opening tag */}}
  {{ $processed = replace $processed $searchStart $structuredDataStart }}
  
  {{/* Replace the closing tag */}}
  {{ $processed = replace $processed $searchEnd $structuredDataEnd }}
{{ end }}

{{ $processed | safeHTML }}