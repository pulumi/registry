{{ define "main" }}
    {{ $directories := (split .Page.File "/")}}
    {{ $packageName := index $directories 2 }}
    {{ $packageHome := path.Join "registry/packages" $packageName }}
    {{ $title_tag := .Params.title_tag }}

    <div class="docs-list-main">
        <div class="docs-main-content-wrapper">
            <div class="docs-main-content">
                {{ partial "docs/breadcrumb.html" . }}

                <div class="package-card-top-of-page">
                    <div class="img-name-version">
                        {{ with (index $.Site.Data.registry.packages ($packageName)) }}
                            <div>
                                {{ partial "registry/package/icon.html" . }}
                            </div>
                        {{ end }}
                        {{ with (index $.Site.Data.registry.packages ($packageName)) }}
                            <p>{{ .title }} {{ .version }}, {{ ((time .updated_on).Format "Jan 2 06") }}</p>
                        {{ end }}
                    </div>
                    <i class="fas fa-chevron-circle-down"></i>
                </div>

                <div class="p-4 border rounded shadow-sm h-30 bg-gray-100 min-w-80 bg-white xl:right-10 md:w-80 w-full package-card-compact">
                    <div class="card-collapsed flex items-center cursor-pointer">
                        <div class="flex max-w-sm">
                            {{ with (index $.Site.Data.registry.packages ($packageName)) }}
                            <div class="flex">
                                {{ partial "registry/package/icon.html" . }}
                            </div>
                            {{ end }}
                        </div>
                        
                        {{ with (index $.Site.Data.registry.packages ($packageName)) }}
                        <div class="flex-grow text-left mx-5 whitespace-nowrap package-header">
                            {{ .title }} {{ .version }}, {{ ((time .updated_on).Format "Jan 2 06") }}
                        </div>
                
                        <div class="caret-container">
                            <i class="package-card-caret fas fa-chevron-circle-down"></i>
                        </div>
                        {{ end }}
                    </div>
                    <div class="hidden package-card-expand">
                        {{ .Scratch.Set "package" $packageName }}
                        {{ partial "registry/package/package-alert.html" . }}
                        {{ with (index $.Site.Data.registry.packages ($packageName)) }}
                            <div class="lg:flex mb-4 text-xs mt-4">
                                {{ .title }} {{ .version }} published on {{ ((time .updated_on).Format "Monday, Jan 2, 2006") }} by {{ .publisher }}
                            </div>
                
                            <div class="flex items-center">
                                <i class="fab fa-github text-base"></i>
                                <span class="text-blue-600 flex flex-wrap items-center">
                                    <a class="text-xs  ml-2 mr-1.5" href="{{ .repo_url }}" target="_blank" rel="noopener noreferrer">
                                        <span class="text-blue-600 underline">{{ replaceRE `^.*.com/` "" .repo_url }}</span>
                                        &nbsp;<i class="fas fa-external-link-alt text-xs"></i>
                                    </a>
                                </span>
                            </div>
                        {{ end }}
                    </div>
                </div>

                {{ partial "registry/package/header.html" . }}

                <div class="special-h1">
                    {{ if strings.Contains .Permalink "installation-configuration" }}
                        <h1>{{ with .GetPage $packageHome }}{{ .Title }}{{ end }}: Installation & Configuration</h1>
                    {{ else if strings.HasSuffix .Permalink "how-to-guides/" }}
                        <h1>{{ with .GetPage $packageHome }}{{ .Title }}{{ end }}: How-to-Guides</h1>
                    {{ else if strings.Contains .Permalink "api-docs" }}
                        <!--Don't show the title in the top-most index page.-->
                        {{ if not (in .Page.File "api-docs/_index.md") }}
                            {{ if and (.Params.h1) (not .Params.notitle) }}
                                <h1>{{ .Params.h1 }}</h1>
                            {{ else if and (ne .Title "") (not .Params.notitle) }}
                                <!-- HACK: azure-native-v2 resources should still belong to azure-native -->
                                <h1 class="break-words">{{ replace $title_tag "azure-native-v2" "azure-native" }}</h1>
                                {{ if not (strings.Contains .Params.meta_desc "module") }}
                                    {{ .Scratch.Set "title_tag" $title_tag }}
                                    {{ partial "registry/package/pulumi-ai.html" . }}
                                {{ end }}
                            {{ end }}
                        {{ else if (in .Page.File "api-docs/_index.md")}}
                            <!-- HACK: to get custom azure-native-v2 title for now. -->
                            {{ if (in .Page.File "azure-native-v2") }}
                                <h1>Azure Native (v2 Preview): API Docs</h1>
                            {{ else }}
                                <h1>{{ .Params.title }}: API Docs</h1>
                            {{ end }}
                        {{ end }}
                    {{ else }}
                        {{ if and (.Params.h1) (not .Params.notitle) }}
                            <h1>{{ .Params.h1 }}</h1>
                        {{ else if and (ne .Title "") (not .Params.notitle) (not (in .Page.File "how-to-guides/_index.md")) }}
                            <h1>{{ .Title }}</h1>
                        {{ end }}
                    {{ end }}
                    <div class="h1-gradient"></div>
                </div>

                <div class="docs-table-of-contents docs-toc-mobile">
                    {{ partial "docs/table-of-contents.html" . }}
                </div>

                {{ if .Params.cloud_overview }}
                    {{ partial "docs/cloud-overview.html" . }}
                {{ end }}

                <section class="docs-content" data-swiftype-index="true">
                    {{ if strings.HasSuffix .Permalink "how-to-guides/" }}
                        {{ if (eq (len .Pages) 0) }}
                            There are no guides yet for this package.
                        {{ else }}
                            {{ if not (eq (len (where .Pages "Params.language" "==" nil)) 0) }}
                                <h2>Featured Guides</h2>

                                {{ range where .Pages "Params.language" "==" nil }}
                                    <div class="pb-4">
                                        <a class="text-blue-600 underline" href="{{ relref . .Path }}">{{ .Title }}</a>
                                    </div>
                                {{ end }}

                                <h2>How-to Guides by Language</h2>
                            {{ end }}

                            <div><pulumi-chooser type="language" options="typescript,javascript,python,go,csharp"></pulumi-chooser></div>

                            <pulumi-choosable type="language" value="typescript">
                            {{ partial "registry/packages/how-to-language-index" (dict "package" . "language" "ts") }}
                            </pulumi-choosable>

                            <pulumi-choosable type="language" value="javascript">
                            {{ partial "registry/packages/how-to-language-index" (dict "package" . "language" "js") }}
                            </pulumi-choosable>

                            <pulumi-choosable type="language" value="python">
                            {{ partial "registry/packages/how-to-language-index" (dict "package" . "language" "py") }}
                            </pulumi-choosable>

                            <pulumi-choosable type="language" value="go">
                            {{ partial "registry/packages/how-to-language-index" (dict "package" . "language" "go") }}
                            </pulumi-choosable>

                            <pulumi-choosable type="language" value="csharp">
                            {{ partial "registry/packages/how-to-language-index" (dict "package" . "language" "cs") }}
                            </pulumi-choosable>
                        {{ end }}
                    {{ else }}
                        {{ .Content }}
                    {{ end }}
                </section>
            </div>

            <div class="docs-table-of-contents docs-toc-desktop">
                {{ partial "docs/table-of-contents.html" . }}
            </div>
        </div>
    </div>
{{ end }}

{{ define "footer" }}
    {{ partial "docs/footer.html" . }}
{{ end }}
