import{r as t,h as s,g as e}from"./p-68998d96.js";import{w as i}from"./p-0225b3e9.js";const o=class{constructor(s){t(this,s),this.sourceFiles=[],this.theme="",this.converting=!1,this.convertible=!1,this.alertDismissed=!1,this.supportedLanguages=[{key:"typescript",name:"TypeScript",filename:"index.ts"},{key:"python",name:"Python",filename:"__main__.py"},{key:"go",name:"Go",filename:"main.go"},{key:"csharp",name:"C#",filename:"MyStack.cs"}]}componentDidLoad(){try{this.validateProps(),this.validateGlobals(),this.prepareEditors(),this.prepareSourceFiles()}catch(t){console.error(t.message)}}get inputEditorEl(){return this.el.querySelector("#editor-input")}get outputEditorEl(){return this.el.querySelector("#editor-output")}get inputEditorMode(){switch(this.from){case"tf":return"ruby";case"kube":case"cf":return"yaml";case"arm":return"javascript"}}get inputEditorValue(){return this.inputEditor.getValue()}get inputEditorDefaultFilename(){switch(this.from){case"tf":return"main.tf";case"kube":return"kube.yaml";case"arm":return"azuredeploy.json";case"cf":return"aws.yaml"}}get sourceLanguageName(){switch(this.from){case"tf":return"Terraform";case"kube":return"Kubernetes YAML";case"arm":return"ARM";case"cf":return"CloudFormation"}}get endpointPath(){switch(this.from){case"tf":return"convert";case"arm":return"convertARM";case"kube":return"convertKube";case"cf":return"convertCFN"}}get conversionTool(){switch(this.from){case"tf":return{name:"the Terraform converter",githubURL:"https://github.com/pulumi/pulumi"};case"kube":return{name:"kube2pulumi",githubURL:"https://github.com/pulumi/kube2pulumi"};case"arm":return{name:"arm2pulumi",githubURL:"https://github.com/pulumi/arm2pulumi"};case"cf":return{name:"cf2pulumi",githubURL:"https://github.com/pulumi/pulumi-aws-native"};default:return{name:`${this.from}2pulumi`,githubURL:"https://github.com/pulumi/pulumi"}}}validateGlobals(){if([typeof CodeMirror,typeof JSZip,typeof saveAs].filter((t=>"undefined"===t)).length>0)throw new Error("The pulumi-convert component requires CodeMirror, JZSip, and FileSaver. Please ensure each of these scripts has been loaded into global before using it.")}validateProps(){const t=[];this.from&&["tf","kube","arm","cf"].includes(this.from)||t.push("A valid `from` attribute is required.");try{this.endpointURL=new URL(this.endpoint)}catch(s){t.push("A valid `endpoint` attribute is required.")}if(this.examples||console.warn("A list of examples was provided."),this.theme||console.warn("A CodeMirror theme was not specified. The Using `material-ocean`."),t.length)throw new Error(t.join("\n"))}prepareEditors(){this.selectedOutputLanguage=this.supportedLanguages[0];const t={lineNumbers:!0,theme:this.theme||""};this.inputEditor=CodeMirror.fromTextArea(this.inputEditorEl,Object.assign(Object.assign({},t),{indentUnit:["kube","cf"].includes(this.from)?2:4,mode:this.inputEditorMode})),this.outputEditor=CodeMirror.fromTextArea(this.outputEditorEl,Object.assign(Object.assign({},t),{readOnly:!0})),this.inputEditor.on("change",(()=>{this.convertible=""!==this.inputEditorValue.trim(),this.selectedSourceFile===this.customSourceFile&&(this.customSourceFile.code=this.inputEditorValue)})),this.inputEditor.on("keydown",((t,s)=>{!s.metaKey||"Enter"!==s.key&&"s"!==s.key||(s.preventDefault(),this.convert())}))}prepareSourceFiles(){if(this.sourceFiles=[],this.examples&&this.examples.length>0)try{this.sourceFiles.push(...JSON.parse(this.examples))}catch(t){console.error("Failed to load examples:",t)}this.customSourceFile={name:"Custom",description:`Convert your own ${this.sourceLanguageName} code.`,filename:this.inputEditorDefaultFilename,code:""},this.sourceFiles.push(this.customSourceFile),this.selectSourceFile(this.sourceFiles[0]),this.convert()}selectSourceFile(t){this.selectedSourceFile=t,this.inputEditor.setValue(t.code),this.inputEditor.clearHistory(),this.convert()}selectOutputLanguage(t){this.selectedOutputLanguage=t,this.convert()}setOutputResult(t){this.outputResult=t,this.outputEditor.setValue(t?t.code:"")}copyToClipboard(){i(this.outputEditor.getValue())}downloadZip(){const t=new JSZip;t.file(this.outputResult.filename,this.outputResult.code),t.generateAsync({type:"blob"}).then((t=>{saveAs(t,`${this.from}2pulumi.zip`)}))}dismissAlert(){this.alertDismissed=!0}async convert(){var t;this.setOutputResult(null);const s=this.inputEditorValue,e=this.selectedOutputLanguage;if(s){this.converting=!0,this.alertDismissed=!1;try{const i=await fetch([this.endpointURL,this.endpointPath].join("/"),{method:"POST",mode:"cors",body:JSON.stringify({code:s,language:e.key})}),o=await i.json();if(o.error)this.setOutputResult({filename:"",code:"",diagnostics:o.diagnostics||"",status:{success:!1,message:o.error}});else if(o.files){let[s,i]=Object.entries(o.files)[0];s.match(/\w+\.\w+/)||(s=this.supportedLanguages.find((t=>t.key===e.key)).filename);const r=(null===(t=o.diagnostics)||void 0===t?void 0:t.replace(/^no diagnostics$/,""))||"";s&&i&&this.setOutputResult({filename:s,code:i,diagnostics:r,status:{success:!0,message:s}}),r&&(this.outputResult.diagnostics=r)}}catch(t){console.error(`Submission failed: ${t}`)}this.converting=!1}}get statusBarClasses(){const t=["status-bar"];return this.converting&&t.push("converting"),this.outputResult&&t.push(this.outputResult.diagnostics?"warn":this.outputResult.status.success?"success":"error"),t.join(" ")}combineClasses(...t){return t.filter((t=>t&&""!==t)).join(" ")}trackEventLabel(t){return this.from&&this.selectedOutputLanguage?["convert",this.from,t,this.selectedOutputLanguage.key].join("-"):""}renderToolDescription(){let t=this.conversionTool.githubURL?s("a",{href:this.conversionTool.githubURL},this.conversionTool.name):this.conversionTool.name;return"tf"===this.from&&(t=s("code",null,"pulumi convert --from terraform")),s("p",null,"Your code will be converted with"," ",t,", an open-source command-line tool we built to make it as easy as possible for you to migrate your existing ",this.sourceLanguageName," projects to Pulumi. The resulting file can be copied or downloaded for use with ",s("a",{href:"https://pulumi.com/start"},"a new Pulumi project"),".")}renderWindowBar(){return s("div",{class:"window-bar"},s("div",{class:"window-bar-buttons"},s("div",{class:"window-bar-button"}),s("div",{class:"window-bar-button"}),s("div",{class:"window-bar-button"})))}renderTab(t,e,i,o,r){return s("li",{onClick:r.bind(this,t),"data-track":this.trackEventLabel("tab"),class:this.combineClasses("tab",t===e?"active":""),title:o},s("span",{class:"label"},i),s("span",{class:"indicator"}))}renderConvertButton(t){var e;const i=`Convert this ${this.sourceLanguageName} code to ${null===(e=this.selectedOutputLanguage)||void 0===e?void 0:e.name}`,o=s("button",{onClick:this.convert.bind(this),"data-track":this.trackEventLabel("button"),class:this.combineClasses("btn-convert",this.converting?"converting":""),title:i,disabled:!this.convertible||this.converting},s("span",{class:"label"},"Convert"),s("span",{class:"icon"}));return t?s("pulumi-tooltip",null,o,s("span",{slot:"content"},i)):o}renderDismissAlertButton(){return s("button",{class:"toggle",title:"Dismiss this message",onClick:this.dismissAlert.bind(this)},s("span",{class:"icon"}))}renderStatusBar(t){var e,i,o,r;switch(t){case"input":return s("div",{class:"status-bar"},s("span",{class:"message"},null===(e=this.selectedSourceFile)||void 0===e?void 0:e.filename,(null===(i=this.selectedSourceFile)||void 0===i?void 0:i.description)?` • ${this.selectedSourceFile.description}`:""));case"output":return s("div",{class:this.statusBarClasses},s("span",{class:"icon"}),s("span",{class:"message"},null===(r=null===(o=this.outputResult)||void 0===o?void 0:o.status)||void 0===r?void 0:r.message),s("div",{class:this.combineClasses("alert","alert-error",this.alertDismissed?"dismissed":void 0)},this.renderDismissAlertButton(),s("p",null,s("strong",null,"Sorry, we were unable to convert your code.")),s("p",null,"There could be a problem with the code you submitted, or it might use a feature ",this.conversionTool.name," doesn't support. Join us in"," ",s("a",{href:"https://slack.pulumi.com/"},"Community Slack")," for help.")),s("div",{class:this.combineClasses("alert","alert-warn",this.alertDismissed?"dismissed":void 0)},this.renderDismissAlertButton(),s("p",null,s("strong",null,"Sorry, we were unable to convert your code completely.")),s("p",null,"The code was valid, but ",this.conversionTool.name," was unable to convert it completely. There could be a problem with the code you submitted, or it might use a feature ",this.conversionTool.name," doesn't support. Join us in ",s("a",{href:"https://slack.pulumi.com/"},"Community Slack")," for help.")));default:return s("div",{class:"status-bar"},s("span",{class:"message"}," "))}}renderDiagnostics(){var t,e;if(null===(t=this.outputResult)||void 0===t?void 0:t.diagnostics)return console.log("Conversion completed with errors. Diagnostics:"),console.log(null===(e=this.outputResult)||void 0===e?void 0:e.diagnostics),s("div",{class:"diagnostics"},s("p",null,s("strong",null,"Diagnostics:")),s("p",{class:"details"},this.outputResult.diagnostics))}render(){return s("div",null,s("div",{id:"editors"},s("div",{class:"editor editor-input"},s("div",{class:"editor-heading"},s("h3",null,s("span",{class:"editor-step"},"1"),"Start with some ",this.sourceLanguageName,"."),s("p",null,"We've included a few examples for reference — feel free to edit them as you like, or replace them with your own code. (And don't worry, we send your code over SSL and don't store anything on our servers.) When you're ready to transform your ",this.sourceLanguageName," code to Pulumi, select ",s("strong",null,"Convert"),".")),s("div",{class:"editor-container"},this.renderWindowBar(),s("ul",{class:"tabs"},this.sourceFiles.map((t=>this.renderTab(t,this.selectedSourceFile,t.name,t.description,this.selectSourceFile))),s("li",{class:"actions"},this.renderConvertButton(!0))),s("textarea",{id:"editor-input"}),this.renderStatusBar("input"))),s("div",{class:this.combineClasses("editor","editor-output",this.converting?"converting":"")},s("div",{class:"editor-heading"},s("h3",null,s("span",{class:"editor-step"},"2"),"Turn it into your language of choice."),this.renderToolDescription(),s("div",null,this.renderConvertButton(!1))),s("div",{class:"editor-container"},this.renderWindowBar(),s("ul",{class:"tabs"},this.supportedLanguages.map((t=>this.renderTab(t,this.selectedOutputLanguage,t.name,t.name,this.selectOutputLanguage))),s("li",{class:"actions"},s("pulumi-tooltip",null,s("button",{onClick:this.copyToClipboard.bind(this),"data-track":this.trackEventLabel("copy"),class:"btn-copy"},s("i",null)),s("span",{slot:"content"},"Copy to clipboard")),s("pulumi-tooltip",null,s("button",{onClick:this.downloadZip.bind(this),"data-track":this.trackEventLabel("download"),class:"btn-download"},s("i",null)),s("span",{slot:"content"},"Download as .zip")))),s("div",{class:"editor-spinner"}),s("textarea",{id:"editor-output"}),this.renderStatusBar("output")),this.renderDiagnostics())))}get el(){return e(this)}};o.style="pulumi-convert{display:block}pulumi-convert textarea{opacity:0}";export{o as pulumi_convert}