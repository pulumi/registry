var t,e=new Uint8Array(16);function n(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}const r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function i(t){return"string"==typeof t&&r.test(t)}for(var s=[],o=0;o<256;++o)s.push((o+256).toString(16).substr(1));function u(t,e,r){var o=(t=t||{}).random||(t.rng||n)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){r=r||0;for(var u=0;u<16;++u)e[r+u]=o[u];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(s[t[e+0]]+s[t[e+1]]+s[t[e+2]]+s[t[e+3]]+"-"+s[t[e+4]]+s[t[e+5]]+"-"+s[t[e+6]]+s[t[e+7]]+"-"+s[t[e+8]]+s[t[e+9]]+"-"+s[t[e+10]]+s[t[e+11]]+s[t[e+12]]+s[t[e+13]]+s[t[e+14]]+s[t[e+15]]).toLowerCase();if(!i(n))throw TypeError("Stringified UUID is invalid");return n}(o)}const c={fetch:globalThis.fetch?globalThis.fetch.bind(globalThis):void 0,SubtleCrypto:globalThis.crypto?globalThis.crypto.subtle:void 0,EventSource:globalThis.EventSource};function a(t){let e=2166136261;const n=t.length;for(let r=0;r<n;r++)e^=t.charCodeAt(r),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}function l(t,e,n){return 2===n?a(a(t+e)+"")%1e4/1e4:1===n?a(e+t)%1e3/1e3:null}function h(t,e){return t>=e[0]&&t<e[1]}function f(t){try{const e=t.replace(/([^\\])\//g,"$1\\/");return new RegExp(e)}catch(t){return void console.error(t)}}function d(t,e){if(!e.length)return!1;let n=!1,r=!1;for(let i=0;i<e.length;i++){const s=p(t,e[i].type,e[i].pattern);if(!1===e[i].include){if(s)return!1}else n=!0,s&&(r=!0)}return r||!n}function p(t,e,n){try{const r=new URL(t,"https://_");if("regex"===e){const t=f(n);return!!t&&(t.test(r.href)||t.test(r.href.substring(r.origin.length)))}return"simple"===e&&function(t,e){try{const n=new URL(e.replace(/^([^:/?]*)\./i,"https://$1.").replace(/\*/g,"_____"),"https://_____"),r=[[t.host,n.host,!1],[t.pathname,n.pathname,!0]];return n.hash&&r.push([t.hash,n.hash,!1]),n.searchParams.forEach(((e,n)=>{r.push([t.searchParams.get(n)||"",e,!1])})),!r.some((t=>!function(t,e,n){try{let r=e.replace(/[*.+?^${}()|[\]\\]/g,"\\$&").replace(/_____/g,".*");return n&&(r="\\/?"+r.replace(/(^\/|\/$)/g,"")+"\\/?"),new RegExp("^"+r+"$","i").test(t)}catch(t){return!1}}(t[0],t[1],t[2])))}catch(t){return!1}}(r,n)}catch(t){return!1}}const y=t=>Uint8Array.from(atob(t),(t=>t.charCodeAt(0)));async function w(t,e,n){if(e=e||"",!(n=n||globalThis.crypto&&globalThis.crypto.subtle||c.SubtleCrypto))throw new Error("No SubtleCrypto implementation found");try{const r=await n.importKey("raw",y(e),{name:"AES-CBC",length:128},!0,["encrypt","decrypt"]),[i,s]=t.split("."),o=await n.decrypt({name:"AES-CBC",iv:y(i)},r,y(s));return(new TextDecoder).decode(o)}catch(t){throw new Error("Failed to decrypt")}}function v(t){return"string"==typeof t?t:JSON.stringify(t)}function g(t){"number"==typeof t&&(t+=""),t&&"string"==typeof t||(t="0");const e=t.replace(/(^v|\+.*$)/g,"").split(/[-.]/);return 3===e.length&&e.push("~"),e.map((t=>t.match(/^[0-9]+$/)?t.padStart(5," "):t)).join("-")}function m(t){return"object"==typeof t&&null!==t}function b(t){return t.urlPatterns&&t.variations.some((t=>m(t)&&"urlRedirect"in t))?"redirect":t.variations.some((t=>m(t)&&(t.domMutations||"js"in t||"css"in t)))?"visual":"unknown"}async function k(t,e){return new Promise((n=>{let r,i=!1;const s=t=>{i||(i=!0,r&&clearTimeout(r),n(t||null))};e&&(r=setTimeout((()=>s()),e)),t.then((t=>s(t))).catch((()=>s()))}))}const S={staleTTL:6e4,maxAge:144e5,cacheKey:"gbFeaturesCache",backgroundSync:!0,maxEntries:10,disableIdleStreams:!1,idleStreamInterval:2e4,disableCache:!1},A=c,$={fetchFeaturesCall:t=>{let{host:e,clientKey:n,headers:r}=t;return A.fetch(`${e}/api/features/${n}`,{headers:r})},fetchRemoteEvalCall:t=>{let{host:e,clientKey:n,payload:r,headers:i}=t;const s={method:"POST",headers:{"Content-Type":"application/json",...i},body:JSON.stringify(r)};return A.fetch(`${e}/api/eval/${n}`,s)},eventSourceCall:t=>{let{host:e,clientKey:n,headers:r}=t;return r?new A.EventSource(`${e}/sub/${n}`,{headers:r}):new A.EventSource(`${e}/sub/${n}`)},startIdleListener:()=>{let t;if("undefined"==typeof window||"undefined"==typeof document)return;const e=()=>{"visible"===document.visibilityState?(window.clearTimeout(t),O.forEach((t=>{t&&"idle"===t.state&&K(t)}))):"hidden"===document.visibilityState&&(t=window.setTimeout(M,S.idleStreamInterval))};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},stopIdleListener:()=>{}};try{globalThis.localStorage&&(A.localStorage=globalThis.localStorage)}catch(t){}const x=new Map;let E=!1;const C=new Map,_=new Map,O=new Map,T=new Set;function M(){O.forEach((t=>{t&&(t.state="idle",L(t))}))}async function D(){try{if(!A.localStorage)return;await A.localStorage.setItem(S.cacheKey,JSON.stringify(Array.from(C.entries())))}catch(t){}}function V(t){const[e,n]=t.getApiInfo();return`${e}||${n}`}function R(t){const e=V(t);if(!("isRemoteEval"in t)||!t.isRemoteEval())return e;const n=t.getAttributes(),r=t.getCacheKeyAttributes()||Object.keys(t.getAttributes()),i={};r.forEach((t=>{i[t]=n[t]}));const s=t.getForcedVariations(),o=t.getUrl();return`${e}||${JSON.stringify({ca:i,fv:s,url:o})}`}function F(){const t=Array.from(C.entries()).map((t=>{let[e,n]=t;return{key:e,staleAt:n.staleAt.getTime()}})).sort(((t,e)=>t.staleAt-e.staleAt)),e=Math.min(Math.max(0,C.size-S.maxEntries),C.size);for(let n=0;n<e;n++)C.delete(t[n].key)}function I(t,e,n){const r=n.dateUpdated||"",i=new Date(Date.now()+S.staleTTL),s=S.disableCache?void 0:C.get(e);if(s&&r&&s.version===r)return s.staleAt=i,void D();S.disableCache||(C.set(e,{data:n,version:r,staleAt:i,sse:T.has(t)}),F()),D();const o=x.get(t);o&&o.forEach((t=>async function(t,e){await t.setPayload(e||t.getPayload())}(t,n)))}async function N(t){const{apiHost:e,apiRequestHeaders:n}=t.getApiHosts(),r=t.getClientKey(),i="isRemoteEval"in t&&t.isRemoteEval(),s=V(t),o=R(t);let u=_.get(o);return u||(u=(i?$.fetchRemoteEvalCall({host:e,clientKey:r,payload:{attributes:t.getAttributes(),forcedVariations:t.getForcedVariations(),forcedFeatures:Array.from(t.getForcedFeatures().entries()),url:t.getUrl()},headers:n}):$.fetchFeaturesCall({host:e,clientKey:r,headers:n})).then((t=>{if(!t.ok)throw new Error(`HTTP error: ${t.status}`);return"enabled"===t.headers.get("x-sse-support")&&T.add(s),t.json()})).then((e=>(I(s,o,e),B(t),_.delete(o),{data:e,success:!0,source:"network"}))).catch((t=>(_.delete(o),{data:null,source:"error",success:!1,error:t}))),_.set(o,u)),u}function B(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=V(t),r=R(t),{streamingHost:i,streamingHostRequestHeaders:s}=t.getApiHosts(),o=t.getClientKey();if(e&&T.add(n),S.backgroundSync&&T.has(n)&&A.EventSource){if(O.has(n))return;const t={src:null,host:i,clientKey:o,headers:s,cb:e=>{try{if("features-updated"===e.type){const t=x.get(n);t&&t.forEach((t=>{N(t)}))}else if("features"===e.type){const t=JSON.parse(e.data);I(n,r,t)}t.errors=0}catch(e){U(t)}},errors:0,state:"active"};O.set(n,t),K(t)}}function U(t){if("idle"!==t.state&&(t.errors++,t.errors>3||t.src&&2===t.src.readyState)){const e=Math.pow(3,t.errors-3)*(1e3+1e3*Math.random());L(t),setTimeout((()=>{["idle","active"].includes(t.state)||K(t)}),Math.min(e,3e5))}}function L(t){t.src&&(t.src.onopen=null,t.src.onerror=null,t.src.close(),t.src=null,"active"===t.state&&(t.state="disabled"))}function K(t){t.src=$.eventSourceCall({host:t.host,clientKey:t.clientKey,headers:t.headers}),t.state="active",t.src.addEventListener("features",t.cb),t.src.addEventListener("features-updated",t.cb),t.src.onerror=()=>U(t),t.src.onopen=()=>{t.errors=0}}function j(t,e){L(t),O.delete(e)}function J(t,e){if(e.streaming){if(!t.getClientKey())throw new Error("Must specify clientKey to enable streaming");e.payload&&B(t,!0),function(t){const e=V(t),n=x.get(e)||new Set;n.add(t),x.set(e,n)}(t)}}var H=/^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/,q={revert:function(){}},P=new Map,G=new Set;function z(t){var e=P.get(t);return e||P.set(t,e={element:t,attributes:{}}),e}function Z(t,e,n,r,i){var s=n(t),o={isDirty:!1,originalValue:s,virtualValue:s,mutations:[],el:t,_positionTimeout:null,observer:new MutationObserver((function(){if("position"!==e||!o._positionTimeout){"position"===e&&(o._positionTimeout=setTimeout((function(){o._positionTimeout=null}),1e3));var r=n(t);"position"===e&&r.parentNode===o.virtualValue.parentNode&&r.insertBeforeNode===o.virtualValue.insertBeforeNode||r!==o.virtualValue&&(o.originalValue=r,i(o))}})),mutationRunner:i,setValue:r,getCurrentValue:n};return"position"===e&&t.parentNode?o.observer.observe(t.parentNode,{childList:!0,subtree:!0,attributes:!1,characterData:!1}):o.observer.observe(t,function(t){return"html"===t?{childList:!0,subtree:!0,attributes:!0,characterData:!0}:{childList:!1,subtree:!1,attributes:!0,attributeFilter:[t]}}(e)),o}function Q(t,e){var n=e.getCurrentValue(e.el);e.virtualValue=t,t&&"string"!=typeof t?n&&t.parentNode===n.parentNode&&t.insertBeforeNode===n.insertBeforeNode||(e.isDirty=!0,yt()):t!==n&&(e.isDirty=!0,yt())}function W(t){var e=t.originalValue;t.mutations.forEach((function(t){return e=t.mutate(e)})),Q(function(t){return ut||(ut=document.createElement("div")),ut.innerHTML=t,ut.innerHTML}(e),t)}function X(t){var e=new Set(t.originalValue.split(/\s+/).filter(Boolean));t.mutations.forEach((function(t){return t.mutate(e)})),Q(Array.from(e).filter(Boolean).join(" "),t)}function Y(t){var e=t.originalValue;t.mutations.forEach((function(t){return e=t.mutate(e)})),Q(e,t)}function tt(t){var e=t.originalValue;t.mutations.forEach((function(t){var n=function(t){var e=t.insertBeforeSelector,n=document.querySelector(t.parentSelector);if(!n)return null;var r=e?document.querySelector(e):null;return e&&!r?null:{parentNode:n,insertBeforeNode:r}}(t.mutate());e=n||e})),Q(e,t)}var et=function(t){return t.innerHTML},nt=function(t,e){return t.innerHTML=e};function rt(t){var e=z(t);return e.html||(e.html=Z(t,"html",et,nt,W)),e.html}var it=function(t){return{parentNode:t.parentElement,insertBeforeNode:t.nextElementSibling}},st=function(t,e){e.insertBeforeNode&&!e.parentNode.contains(e.insertBeforeNode)||e.parentNode.insertBefore(t,e.insertBeforeNode)};function ot(t){var e=z(t);return e.position||(e.position=Z(t,"position",it,st,tt)),e.position}var ut,ct,at=function(t,e){return e?t.className=e:t.removeAttribute("class")},lt=function(t){return t.className};function ht(t){var e=z(t);return e.classes||(e.classes=Z(t,"class",lt,at,X)),e.classes}function ft(t,e){var n,r=z(t);return r.attributes[e]||(r.attributes[e]=Z(t,e,(n=e,function(t){var e;return null!=(e=t.getAttribute(n))?e:null}),function(t){return function(e,n){return null!==n?e.setAttribute(t,n):e.removeAttribute(t)}}(e),Y)),r.attributes[e]}function dt(t,e,n){if(n.isDirty){n.isDirty=!1;var r=n.virtualValue;n.mutations.length||function(t,e){var n,r,i=P.get(t);if(i)if("html"===e)null==(n=i.html)||null==(r=n.observer)||r.disconnect(),delete i.html;else if("class"===e){var s,o;null==(s=i.classes)||null==(o=s.observer)||o.disconnect(),delete i.classes}else if("position"===e){var u,c;null==(u=i.position)||null==(c=u.observer)||c.disconnect(),delete i.position}else{var a,l,h;null==(a=i.attributes)||null==(l=a[e])||null==(h=l.observer)||h.disconnect(),delete i.attributes[e]}}(t,e),n.setValue(t,r)}}function pt(t,e){t.html&&dt(e,"html",t.html),t.classes&&dt(e,"class",t.classes),t.position&&dt(e,"position",t.position),Object.keys(t.attributes).forEach((function(n){dt(e,n,t.attributes[n])}))}function yt(){P.forEach(pt)}function wt(t){if("position"!==t.kind||1!==t.elements.size){var e=new Set(t.elements);document.querySelectorAll(t.selector).forEach((function(n){e.has(n)||(t.elements.add(n),function(t,e){var n=null;"html"===t.kind?n=rt(e):"class"===t.kind?n=ht(e):"attribute"===t.kind?n=ft(e,t.attribute):"position"===t.kind&&(n=ot(e)),n&&(n.mutations.push(t),n.mutationRunner(n))}(t,n))}))}}function vt(){G.forEach(wt)}function gt(t){return"undefined"==typeof document?q:(G.add(t),wt(t),{revert:function(){var e;(e=t).elements.forEach((function(t){return function(t,e){var n=null;if("html"===t.kind?n=rt(e):"class"===t.kind?n=ht(e):"attribute"===t.kind?n=ft(e,t.attribute):"position"===t.kind&&(n=ot(e)),n){var r=n.mutations.indexOf(t);-1!==r&&n.mutations.splice(r,1),n.mutationRunner(n)}}(e,t)})),e.elements.clear(),G.delete(e)}})}function mt(t,e){return gt({kind:"html",elements:new Set,mutate:e,selector:t})}function bt(t,e){return gt({kind:"position",elements:new Set,mutate:e,selector:t})}function kt(t,e){return gt({kind:"class",elements:new Set,mutate:e,selector:t})}function St(t,e,n){return H.test(e)?"class"===e||"className"===e?kt(t,(function(t){var e=n(Array.from(t).join(" "));t.clear(),e&&e.split(/\s+/g).filter(Boolean).forEach((function(e){return t.add(e)}))})):gt({kind:"attribute",attribute:e,elements:new Set,mutate:n,selector:t}):q}"undefined"!=typeof document&&(ct||(ct=new MutationObserver((function(){vt()}))),vt(),ct.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!1,characterData:!1}));var At=function(t){var e=t.selector,n=t.action,r=t.value,i=t.attribute,s=t.parentSelector,o=t.insertBeforeSelector;if("html"===i){if("append"===n)return mt(e,(function(t){return t+(null!=r?r:"")}));if("set"===n)return mt(e,(function(){return null!=r?r:""}))}else if("class"===i){if("append"===n)return kt(e,(function(t){r&&t.add(r)}));if("remove"===n)return kt(e,(function(t){r&&t.delete(r)}));if("set"===n)return kt(e,(function(t){t.clear(),r&&t.add(r)}))}else if("position"===i){if("set"===n&&s)return bt(e,(function(){return{insertBeforeSelector:o,parentSelector:s}}))}else{if("append"===n)return St(e,i,(function(t){return null!==t?t+(null!=r?r:""):null!=r?r:""}));if("set"===n)return St(e,i,(function(){return null!=r?r:""}));if("remove"===n)return St(e,i,(function(){return null}))}return q};const $t={};function xt(t,e,n){n=n||{};for(const[r,i]of Object.entries(e))switch(r){case"$or":if(!Mt(t,i,n))return!1;break;case"$nor":if(Mt(t,i,n))return!1;break;case"$and":if(!Dt(t,i,n))return!1;break;case"$not":if(xt(t,i,n))return!1;break;default:if(!Ct(i,Et(t,r),n))return!1}return!0}function Et(t,e){const n=e.split(".");let r=t;for(let t=0;t<n.length;t++){if(!r||"object"!=typeof r||!(n[t]in r))return null;r=r[n[t]]}return r}function Ct(t,e,n){if("string"==typeof t)return e+""===t;if("number"==typeof t)return 1*e===t;if("boolean"==typeof t)return null!==e&&!!e===t;if(null===t)return null===e;if(Array.isArray(t)||!_t(t))return JSON.stringify(e)===JSON.stringify(t);for(const r in t)if(!Tt(r,e,t[r],n))return!1;return!0}function _t(t){const e=Object.keys(t);return e.length>0&&e.filter((t=>"$"===t[0])).length===e.length}function Ot(t,e){return Array.isArray(t)?t.some((t=>e.includes(t))):e.includes(t)}function Tt(t,e,n,r){switch(t){case"$veq":return g(e)===g(n);case"$vne":return g(e)!==g(n);case"$vgt":return g(e)>g(n);case"$vgte":return g(e)>=g(n);case"$vlt":return g(e)<g(n);case"$vlte":return g(e)<=g(n);case"$eq":return e===n;case"$ne":return e!==n;case"$lt":return e<n;case"$lte":return e<=n;case"$gt":return e>n;case"$gte":return e>=n;case"$exists":return n?null!=e:null==e;case"$in":return!!Array.isArray(n)&&Ot(e,n);case"$inGroup":return Ot(e,r[n]||[]);case"$notInGroup":return!Ot(e,r[n]||[]);case"$nin":return!!Array.isArray(n)&&!Ot(e,n);case"$not":return!Ct(n,e,r);case"$size":return!!Array.isArray(e)&&Ct(n,e.length,r);case"$elemMatch":return function(t,e,n){if(!Array.isArray(t))return!1;const r=_t(e)?t=>Ct(e,t,n):t=>xt(t,e,n);for(let e=0;e<t.length;e++)if(t[e]&&r(t[e]))return!0;return!1}(e,n,r);case"$all":if(!Array.isArray(e))return!1;for(let t=0;t<n.length;t++){let i=!1;for(let s=0;s<e.length;s++)if(Ct(n[t],e[s],r)){i=!0;break}if(!i)return!1}return!0;case"$regex":try{return(i=n,$t[i]||($t[i]=new RegExp(i.replace(/([^\\])\//g,"$1\\/"))),$t[i]).test(e)}catch(t){return!1}case"$type":return function(t){if(null===t)return"null";if(Array.isArray(t))return"array";const e=typeof t;return["string","number","boolean","object","undefined"].includes(e)?e:"unknown"}(e)===n;default:return console.error("Unknown operator: "+t),!1}var i}function Mt(t,e,n){if(!e.length)return!0;for(let r=0;r<e.length;r++)if(xt(t,e[r],n))return!0;return!1}function Dt(t,e,n){for(let r=0;r<e.length;r++)if(!xt(t,e[r],n))return!1;return!0}async function Vt(t){try{await t()}catch(t){}}function Rt(t,e,n){if(t.user.trackedExperiments){const r=Gt(e,n);if(t.user.trackedExperiments.has(r))return[];t.user.trackedExperiments.add(r)}t.user.enableDevMode&&t.user.devLogs&&t.user.devLogs.push({experiment:e,result:n,timestamp:Date.now().toString(),logType:"experiment"});const r=[];if(t.global.trackingCallback){const i=t.global.trackingCallback;r.push(Vt((()=>i(e,n,t.user))))}if(t.user.trackingCallback){const i=t.user.trackingCallback;r.push(Vt((()=>i(e,n))))}if(t.global.eventLogger){const i=t.global.eventLogger;r.push(Vt((()=>i("Experiment Viewed",{experimentId:e.key,variationId:n.key,hashAttribute:n.hashAttribute,hashValue:n.hashValue},t.user))))}return r}function Ft(t,e){if(e.stack.evaluatedFeatures.has(t))return Nt(e,t,null,"cyclicPrerequisite");e.stack.evaluatedFeatures.add(t),e.stack.id=t;const n=function(t){const e=new Map;return t.global.forcedFeatureValues&&t.global.forcedFeatureValues.forEach(((t,n)=>e.set(n,t))),t.user.forcedFeatureValues&&t.user.forcedFeatureValues.forEach(((t,n)=>e.set(n,t))),e}(e);if(n.has(t))return Nt(e,t,n.get(t),"override");if(!e.global.features||!e.global.features[t])return Nt(e,t,null,"unknownFeature");const r=e.global.features[t];if(r.rules){const n=new Set(e.stack.evaluatedFeatures);t:for(const i of r.rules){if(i.parentConditions)for(const r of i.parentConditions){e.stack.evaluatedFeatures=new Set(n);const i=Ft(r.id,e);if("cyclicPrerequisite"===i.source)return Nt(e,t,null,"cyclicPrerequisite");if(!xt({value:i.value},r.condition||{})){if(r.gate)return Nt(e,t,null,"prerequisite");continue t}}if(i.filters&&Lt(i.filters,e))continue;if("force"in i){if(i.condition&&!Ut(i.condition,e))continue;if(!Kt(e,i.seed||t,i.hashAttribute,e.user.saveStickyBucketAssignmentDoc&&!i.disableStickyBucketing?i.fallbackAttribute:void 0,i.range,i.coverage,i.hashVersion))continue;return i.tracks&&i.tracks.forEach((t=>{!Rt(e,t.experiment,t.result).length&&e.global.saveDeferredTrack&&e.global.saveDeferredTrack({experiment:t.experiment,result:t.result})})),Nt(e,t,i.force,"force",i.id)}if(!i.variations)continue;const r={variations:i.variations,key:i.key||t};"coverage"in i&&(r.coverage=i.coverage),i.weights&&(r.weights=i.weights),i.hashAttribute&&(r.hashAttribute=i.hashAttribute),i.fallbackAttribute&&(r.fallbackAttribute=i.fallbackAttribute),i.disableStickyBucketing&&(r.disableStickyBucketing=i.disableStickyBucketing),void 0!==i.bucketVersion&&(r.bucketVersion=i.bucketVersion),void 0!==i.minBucketVersion&&(r.minBucketVersion=i.minBucketVersion),i.namespace&&(r.namespace=i.namespace),i.meta&&(r.meta=i.meta),i.ranges&&(r.ranges=i.ranges),i.name&&(r.name=i.name),i.phase&&(r.phase=i.phase),i.seed&&(r.seed=i.seed),i.hashVersion&&(r.hashVersion=i.hashVersion),i.filters&&(r.filters=i.filters),i.condition&&(r.condition=i.condition);const{result:s}=It(r,t,e);if(e.global.onExperimentEval&&e.global.onExperimentEval(r,s),s.inExperiment&&!s.passthrough)return Nt(e,t,s.value,"experiment",i.id,r,s)}}return Nt(e,t,void 0===r.defaultValue?null:r.defaultValue,"defaultValue")}function It(t,e,n){const r=t.key,i=t.variations.length;if(i<2)return{result:jt(n,t,-1,!1,e)};if(!1===n.global.enabled||!1===n.user.enabled)return{result:jt(n,t,-1,!1,e)};if((t=function(t,e){const n=t.key,r=e.global.overrides;return r&&r[n]&&"string"==typeof(t=Object.assign({},t,r[n])).url&&(t.url=f(t.url)),t}(t,n)).urlPatterns&&!d(n.user.url||"",t.urlPatterns))return{result:jt(n,t,-1,!1,e)};const s=function(t,e,n){if(!e)return null;const r=e.split("?")[1];if(!r)return null;const i=r.replace(/#.*/,"").split("&").map((t=>t.split("=",2))).filter((e=>{let[n]=e;return n===t})).map((t=>{let[,e]=t;return parseInt(e)}));return i.length>0&&i[0]>=0&&i[0]<n?i[0]:null}(r,n.user.url||"",i);if(null!==s)return{result:jt(n,t,s,!1,e)};const o=function(t){return t.global.forcedVariations&&t.user.forcedVariations?{...t.global.forcedVariations,...t.user.forcedVariations}:t.global.forcedVariations?t.global.forcedVariations:t.user.forcedVariations?t.user.forcedVariations:{}}(n);if(r in o)return{result:jt(n,t,o[r],!1,e)};if("draft"===t.status||!1===t.active)return{result:jt(n,t,-1,!1,e)};const{hashAttribute:u,hashValue:c}=Jt(n,t.hashAttribute,n.user.saveStickyBucketAssignmentDoc&&!t.disableStickyBucketing?t.fallbackAttribute:void 0);if(!c)return{result:jt(n,t,-1,!1,e)};let a=-1,p=!1,y=!1;if(n.user.saveStickyBucketAssignmentDoc&&!t.disableStickyBucketing){const{variation:e,versionIsBlocked:r}=function(t){let{ctx:e,expKey:n,expBucketVersion:r,expHashAttribute:i,expFallbackAttribute:s,expMinBucketVersion:o,expMeta:u}=t;r=r||0,o=o||0,i=i||"id",u=u||[];const c=Ht(n,r),a=function(t,e,n){if(!t.user.stickyBucketAssignmentDocs)return{};const{hashAttribute:r,hashValue:i}=Jt(t,e),s=qt(r,v(i)),{hashAttribute:o,hashValue:u}=Jt(t,n),c=u?qt(o,v(u)):null,a={};return c&&t.user.stickyBucketAssignmentDocs[c]&&Object.assign(a,t.user.stickyBucketAssignmentDocs[c].assignments||{}),t.user.stickyBucketAssignmentDocs[s]&&Object.assign(a,t.user.stickyBucketAssignmentDocs[s].assignments||{}),a}(e,i,s);if(o>0)for(let t=0;t<=o;t++)if(void 0!==a[Ht(n,t)])return{variation:-1,versionIsBlocked:!0};const l=a[c];if(void 0===l)return{variation:-1};const h=u.findIndex((t=>t.key===l));return h<0?{variation:-1}:{variation:h}}({ctx:n,expKey:t.key,expBucketVersion:t.bucketVersion,expHashAttribute:t.hashAttribute,expFallbackAttribute:t.fallbackAttribute,expMinBucketVersion:t.minBucketVersion,expMeta:t.meta});p=e>=0,a=e,y=!!r}if(!p){if(t.filters){if(Lt(t.filters,n))return{result:jt(n,t,-1,!1,e)}}else if(t.namespace&&!function(t,e){const n=l("__"+e[0],t,1);return null!==n&&n>=e[1]&&n<e[2]}(c,t.namespace))return{result:jt(n,t,-1,!1,e)};if(t.include&&!function(t){try{return t()}catch(t){return console.error(t),!1}}(t.include))return{result:jt(n,t,-1,!1,e)};if(t.condition&&!Ut(t.condition,n))return{result:jt(n,t,-1,!1,e)};if(t.parentConditions){const r=new Set(n.stack.evaluatedFeatures);for(const i of t.parentConditions){n.stack.evaluatedFeatures=new Set(r);const s=Ft(i.id,n);if("cyclicPrerequisite"===s.source)return{result:jt(n,t,-1,!1,e)};if(!xt({value:s.value},i.condition||{}))return{result:jt(n,t,-1,!1,e)}}}if(t.groups&&!function(t,e){const n=e.global.groups||{};for(let e=0;e<t.length;e++)if(n[t[e]])return!0;return!1}(t.groups,n))return{result:jt(n,t,-1,!1,e)}}if(t.url&&!function(t,e){const n=e.user.url;if(!n)return!1;const r=n.replace(/^https?:\/\//,"").replace(/^[^/]*\//,"/");return!!t.test(n)||!!t.test(r)}(t.url,n))return{result:jt(n,t,-1,!1,e)};const w=l(t.seed||r,c,t.hashVersion||1);if(null===w)return{result:jt(n,t,-1,!1,e)};if(p||(a=function(t,e){for(let n=0;n<e.length;n++)if(h(t,e[n]))return n;return-1}(w,t.ranges||function(t,e,n){(e=void 0===e?1:e)<0?e=0:e>1&&(e=1);const r=(i=t)<=0?[]:new Array(i).fill(1/i);var i;(n=n||r).length!==t&&(n=r);const s=n.reduce(((t,e)=>e+t),0);(s<.99||s>1.01)&&(n=r);let o=0;return n.map((t=>{const n=o;return o+=t,[n,n+e*t]}))}(i,void 0===t.coverage?1:t.coverage,t.weights))),y)return{result:jt(n,t,-1,!1,e,void 0,!0)};if(a<0)return{result:jt(n,t,-1,!1,e)};if("force"in t)return{result:jt(n,t,void 0===t.force?-1:t.force,!1,e)};if(n.global.qaMode||n.user.qaMode)return{result:jt(n,t,-1,!1,e)};if("stopped"===t.status)return{result:jt(n,t,-1,!1,e)};const g=jt(n,t,a,!0,e,w,p);if(n.user.saveStickyBucketAssignmentDoc&&!t.disableStickyBucketing){const{changed:e,key:r,doc:i}=function(t,e,n,r){const i=qt(e,n),s=t.user.stickyBucketAssignmentDocs&&t.user.stickyBucketAssignmentDocs[i]&&t.user.stickyBucketAssignmentDocs[i].assignments||{},o={...s,...r};return{key:i,doc:{attributeName:e,attributeValue:n,assignments:o},changed:JSON.stringify(s)!==JSON.stringify(o)}}(n,u,v(c),{[Ht(t.key,t.bucketVersion)]:g.key});e&&(n.user.stickyBucketAssignmentDocs=n.user.stickyBucketAssignmentDocs||{},n.user.stickyBucketAssignmentDocs[r]=i,n.user.saveStickyBucketAssignmentDoc(i))}const m=Rt(n,t,g);0===m.length&&n.global.saveDeferredTrack&&n.global.saveDeferredTrack({experiment:t,result:g});const b=m.length?1===m.length?m[0]:Promise.all(m).then((()=>{})):void 0;return"changeId"in t&&t.changeId&&n.global.recordChangeId&&n.global.recordChangeId(t.changeId),{result:g,trackingCall:b}}function Nt(t,e,n,r,i,s,o){const u={value:n,on:!!n,off:!n,source:r,ruleId:i||""};return s&&(u.experiment=s),o&&(u.experimentResult=o),"override"!==r&&function(t,e,n){if(t.user.trackedFeatureUsage){const r=JSON.stringify(n.value);if(t.user.trackedFeatureUsage[e]===r)return;t.user.trackedFeatureUsage[e]=r,t.user.enableDevMode&&t.user.devLogs&&t.user.devLogs.push({featureKey:e,result:n,timestamp:Date.now().toString(),logType:"feature"})}if(t.global.onFeatureUsage){const r=t.global.onFeatureUsage;Vt((()=>r(e,n,t.user)))}if(t.user.onFeatureUsage){const r=t.user.onFeatureUsage;Vt((()=>r(e,n)))}if(t.global.eventLogger){const r=t.global.eventLogger;Vt((()=>r("Feature Evaluated",{feature:e,source:n.source,value:n.value,ruleId:"defaultValue"===n.source?"$default":n.ruleId||"",variationId:n.experimentResult?n.experimentResult.key:""},t.user)))}}(t,e,u),u}function Bt(t){return{...t.user.attributes,...t.user.attributeOverrides}}function Ut(t,e){return xt(Bt(e),t,e.global.savedGroups||{})}function Lt(t,e){return t.some((t=>{const{hashValue:n}=Jt(e,t.attribute);if(!n)return!0;const r=l(t.seed,n,t.hashVersion||2);return null===r||!t.ranges.some((t=>h(r,t)))}))}function Kt(t,e,n,r,i,s,o){if(!i&&void 0===s)return!0;if(!i&&0===s)return!1;const{hashValue:u}=Jt(t,n,r);if(!u)return!1;const c=l(e,u,o||1);return null!==c&&(i?h(c,i):void 0===s||c<=s)}function jt(t,e,n,r,i,s,o){let u=!0;(n<0||n>=e.variations.length)&&(n=0,u=!1);const{hashAttribute:c,hashValue:a}=Jt(t,e.hashAttribute,t.user.saveStickyBucketAssignmentDoc&&!e.disableStickyBucketing?e.fallbackAttribute:void 0),l=e.meta?e.meta[n]:{},h={key:l.key||""+n,featureId:i,inExperiment:u,hashUsed:r,variationId:n,value:e.variations[n],hashAttribute:c,hashValue:a,stickyBucketUsed:!!o};return l.name&&(h.name=l.name),void 0!==s&&(h.bucket=s),l.passthrough&&(h.passthrough=l.passthrough),h}function Jt(t,e,n){let r=e||"id",i="";const s=Bt(t);return s[r]&&(i=s[r]),!i&&n&&(s[n]&&(i=s[n]),i&&(r=n)),{hashAttribute:r,hashValue:i}}function Ht(t,e){return`${t}__${e=e||0}`}function qt(t,e){return`${t}||${e}`}function Pt(t,e){const n={};return function(t,e){const n=new Set,r=e&&e.features?e.features:t.global.features||{},i=e&&e.experiments?e.experiments:t.global.experiments||[];return Object.keys(r).forEach((t=>{const e=r[t];if(e.rules)for(const t of e.rules)t.variations&&(n.add(t.hashAttribute||"id"),t.fallbackAttribute&&n.add(t.fallbackAttribute))})),i.map((t=>{n.add(t.hashAttribute||"id"),t.fallbackAttribute&&n.add(t.fallbackAttribute)})),Array.from(n)}(t,e).forEach((e=>{const{hashValue:r}=Jt(t,e);n[e]=v(r)})),n}function Gt(t,e){return e.hashAttribute+e.hashValue+t.key+e.variationId}const zt="undefined"!=typeof window&&"undefined"!=typeof document,Zt=function(){let t;try{t="1.6.1"}catch(e){t=""}return t}(),Qt=new class{constructor(t){if(t=t||{},this.version=Zt,this._options=this.context=t,this._renderer=t.renderer||null,this._trackedExperiments=new Set,this._completedChangeIds=new Set,this._trackedFeatures={},this.debug=!!t.debug,this._subscriptions=new Set,this.ready=!1,this._assigned=new Map,this._activeAutoExperiments=new Map,this._triggeredExpKeys=new Set,this._initialized=!1,this._redirectedUrl="",this._deferredTrackingCalls=new Map,this._autoExperimentsAllowed=!t.disableExperimentsOnLoad,this._destroyCallbacks=[],this.logs=[],this.log=this.log.bind(this),this._saveDeferredTrack=this._saveDeferredTrack.bind(this),this._fireSubscriptions=this._fireSubscriptions.bind(this),this._recordChangedId=this._recordChangedId.bind(this),t.remoteEval){if(t.decryptionKey)throw new Error("Encryption is not available for remoteEval");if(!t.clientKey)throw new Error("Missing clientKey");let e=!1;try{e=!!new URL(t.apiHost||"").hostname.match(/growthbook\.io$/i)}catch(t){}if(e)throw new Error("Cannot use remoteEval on GrowthBook Cloud")}else if(t.cacheKeyAttributes)throw new Error("cacheKeyAttributes are only used for remoteEval");if(t.stickyBucketService){const e=t.stickyBucketService;this._saveStickyBucketAssignmentDoc=t=>e.saveAssignments(t)}if(t.plugins)for(const e of t.plugins)e(this);if(t.features&&(this.ready=!0),zt&&t.enableDevMode&&(window._growthbook=this,document.dispatchEvent(new Event("gbloaded"))),t.experiments&&(this.ready=!0,this._updateAllAutoExperiments()),this._options.stickyBucketService&&this._options.stickyBucketAssignmentDocs)for(const t in this._options.stickyBucketAssignmentDocs){const e=this._options.stickyBucketAssignmentDocs[t];e&&this._options.stickyBucketService.saveAssignments(e).catch((()=>{}))}this.ready&&this.refreshStickyBuckets(this.getPayload())}async setPayload(t){this._payload=t;const e=await async function(t,e,n){if((t={...t}).encryptedFeatures){try{t.features=JSON.parse(await w(t.encryptedFeatures,e,n))}catch(t){console.error(t)}delete t.encryptedFeatures}if(t.encryptedExperiments){try{t.experiments=JSON.parse(await w(t.encryptedExperiments,e,n))}catch(t){console.error(t)}delete t.encryptedExperiments}if(t.encryptedSavedGroups){try{t.savedGroups=JSON.parse(await w(t.encryptedSavedGroups,e,n))}catch(t){console.error(t)}delete t.encryptedSavedGroups}return t}(t,this._options.decryptionKey);this._decryptedPayload=e,await this.refreshStickyBuckets(e),e.features&&(this._options.features=e.features),e.savedGroups&&(this._options.savedGroups=e.savedGroups),e.experiments&&(this._options.experiments=e.experiments,this._updateAllAutoExperiments()),this.ready=!0,this._render()}initSync(t){this._initialized=!0;const e=t.payload;if(e.encryptedExperiments||e.encryptedFeatures)throw new Error("initSync does not support encrypted payloads");return this._options.stickyBucketService&&!this._options.stickyBucketAssignmentDocs&&(this._options.stickyBucketAssignmentDocs=this.generateStickyBucketAssignmentDocsSync(this._options.stickyBucketService,e)),this._payload=e,this._decryptedPayload=e,e.features&&(this._options.features=e.features),e.experiments&&(this._options.experiments=e.experiments,this._updateAllAutoExperiments()),this.ready=!0,J(this,t),this}async init(t){if(this._initialized=!0,(t=t||{}).cacheSettings&&(Object.assign(S,t.cacheSettings),S.backgroundSync||(T.clear(),O.forEach(j),x.clear(),$.stopIdleListener())),t.payload)return await this.setPayload(t.payload),J(this,t),{success:!0,source:"init"};{const{data:e,...n}=await this._refresh({...t,allowStale:!0});return J(this,t),await this.setPayload(e||{}),n}}async loadFeatures(t){t=t||{},await this.init({skipCache:t.skipCache,timeout:t.timeout,streaming:(this._options.backgroundSync??!0)&&(t.autoRefresh||this._options.subscribeToChanges)})}async refreshFeatures(t){const e=await this._refresh({...t||{},allowStale:!1});e.data&&await this.setPayload(e.data)}getApiInfo(){return[this.getApiHosts().apiHost,this.getClientKey()]}getApiHosts(){return function(t){const e=t.apiHost||"https://cdn.growthbook.io";return{apiHost:e.replace(/\/*$/,""),streamingHost:(t.streamingHost||e).replace(/\/*$/,""),apiRequestHeaders:t.apiHostRequestHeaders,streamingHostRequestHeaders:t.streamingHostRequestHeaders}}(this._options)}getClientKey(){return this._options.clientKey||""}getPayload(){return this._payload||{features:this.getFeatures(),experiments:this.getExperiments()}}getDecryptedPayload(){return this._decryptedPayload||this.getPayload()}isRemoteEval(){return this._options.remoteEval||!1}getCacheKeyAttributes(){return this._options.cacheKeyAttributes}async _refresh(t){let{timeout:e,skipCache:n,allowStale:r,streaming:i}=t;if(!this._options.clientKey)throw new Error("Missing clientKey");return async function(t){let{instance:e,timeout:n,skipCache:r,allowStale:i,backgroundSync:s}=t;return s||(S.backgroundSync=!1),async function(t){let{instance:e,allowStale:n,timeout:r,skipCache:i}=t;const s=V(e),o=R(e),u=new Date,c=new Date(u.getTime()-S.maxAge+S.staleTTL);await async function(){if(!E){E=!0;try{if(A.localStorage){const t=await A.localStorage.getItem(S.cacheKey);if(!S.disableCache&&t){const e=JSON.parse(t);e&&Array.isArray(e)&&e.forEach((t=>{let[e,n]=t;C.set(e,{...n,staleAt:new Date(n.staleAt)})})),F()}}}catch(t){}if(!S.disableIdleStreams){const t=$.startIdleListener();t&&($.stopIdleListener=t)}}}();const a=S.disableCache||i?void 0:C.get(o);return a&&(n||a.staleAt>u)&&a.staleAt>c?(a.sse&&T.add(s),a.staleAt<u?N(e):B(e),{data:a.data,success:!0,source:"cache"}):await k(N(e),r)||{data:null,success:!1,source:"timeout",error:new Error("Timeout")}}({instance:e,allowStale:i,timeout:n,skipCache:r})}({instance:this,timeout:e,skipCache:n||this._options.disableCache,allowStale:r,backgroundSync:i??this._options.backgroundSync??!0})}_render(){if(this._renderer)try{this._renderer()}catch(t){console.error("Failed to render",t)}}setFeatures(t){this._options.features=t,this.ready=!0,this._render()}async setEncryptedFeatures(t,e,n){const r=await w(t,e||this._options.decryptionKey,n);this.setFeatures(JSON.parse(r))}setExperiments(t){this._options.experiments=t,this.ready=!0,this._updateAllAutoExperiments()}async setEncryptedExperiments(t,e,n){const r=await w(t,e||this._options.decryptionKey,n);this.setExperiments(JSON.parse(r))}async setAttributes(t){this._options.attributes=t,this._options.stickyBucketService&&await this.refreshStickyBuckets(),this._options.remoteEval?await this._refreshForRemoteEval():(this._render(),this._updateAllAutoExperiments())}async updateAttributes(t){return this.setAttributes({...this._options.attributes,...t})}async setAttributeOverrides(t){this._options.attributeOverrides=t,this._options.stickyBucketService&&await this.refreshStickyBuckets(),this._options.remoteEval?await this._refreshForRemoteEval():(this._render(),this._updateAllAutoExperiments())}async setForcedVariations(t){this._options.forcedVariations=t||{},this._options.remoteEval?await this._refreshForRemoteEval():(this._render(),this._updateAllAutoExperiments())}setForcedFeatures(t){this._options.forcedFeatureValues=t,this._render()}async setURL(t){if(t!==this._options.url){if(this._options.url=t,this._redirectedUrl="",this._options.remoteEval)return await this._refreshForRemoteEval(),void this._updateAllAutoExperiments(!0);this._updateAllAutoExperiments(!0)}}getAttributes(){return{...this._options.attributes,...this._options.attributeOverrides}}getForcedVariations(){return this._options.forcedVariations||{}}getForcedFeatures(){return this._options.forcedFeatureValues||new Map}getStickyBucketAssignmentDocs(){return this._options.stickyBucketAssignmentDocs||{}}getUrl(){return this._options.url||""}getFeatures(){return this._options.features||{}}getExperiments(){return this._options.experiments||[]}getCompletedChangeIds(){return Array.from(this._completedChangeIds)}subscribe(t){return this._subscriptions.add(t),()=>{this._subscriptions.delete(t)}}async _refreshForRemoteEval(){if(!this._options.remoteEval)return;if(!this._initialized)return;const t=await this._refresh({allowStale:!1});t.data&&await this.setPayload(t.data)}getAllResults(){return new Map(this._assigned)}onDestroy(t){this._destroyCallbacks.push(t)}isDestroyed(){return!!this._destroyed}destroy(){var t;this._destroyed=!0,this._destroyCallbacks.forEach((t=>{try{t()}catch(t){console.error(t)}})),this._subscriptions.clear(),this._assigned.clear(),this._trackedExperiments.clear(),this._completedChangeIds.clear(),this._deferredTrackingCalls.clear(),this._trackedFeatures={},this._destroyCallbacks=[],this._payload=void 0,this._saveStickyBucketAssignmentDoc=void 0,t=this,x.forEach((e=>e.delete(t))),this.logs=[],zt&&window._growthbook===this&&delete window._growthbook,this._activeAutoExperiments.forEach((t=>{t.undo()})),this._activeAutoExperiments.clear(),this._triggeredExpKeys.clear()}setRenderer(t){this._renderer=t}forceVariation(t,e){this._options.forcedVariations=this._options.forcedVariations||{},this._options.forcedVariations[t]=e,this._options.remoteEval?this._refreshForRemoteEval():(this._updateAllAutoExperiments(),this._render())}run(t){const{result:e}=It(t,null,this._getEvalContext());return this._fireSubscriptions(t,e),e}triggerExperiment(t){return this._triggeredExpKeys.add(t),this._options.experiments?this._options.experiments.filter((e=>e.key===t)).map((t=>this._runAutoExperiment(t))).filter((t=>null!==t)):null}triggerAutoExperiments(){this._autoExperimentsAllowed=!0,this._updateAllAutoExperiments(!0)}_getEvalContext(){return{user:this._getUserContext(),global:this._getGlobalContext(),stack:{evaluatedFeatures:new Set}}}_getUserContext(){return{attributes:this._options.user?{...this._options.user,...this._options.attributes}:this._options.attributes,enableDevMode:this._options.enableDevMode,blockedChangeIds:this._options.blockedChangeIds,stickyBucketAssignmentDocs:this._options.stickyBucketAssignmentDocs,url:this._getContextUrl(),forcedVariations:this._options.forcedVariations,forcedFeatureValues:this._options.forcedFeatureValues,attributeOverrides:this._options.attributeOverrides,saveStickyBucketAssignmentDoc:this._saveStickyBucketAssignmentDoc,trackingCallback:this._options.trackingCallback,onFeatureUsage:this._options.onFeatureUsage,devLogs:this.logs,trackedExperiments:this._trackedExperiments,trackedFeatureUsage:this._trackedFeatures}}_getGlobalContext(){return{features:this._options.features,experiments:this._options.experiments,log:this.log,enabled:this._options.enabled,qaMode:this._options.qaMode,savedGroups:this._options.savedGroups,groups:this._options.groups,overrides:this._options.overrides,onExperimentEval:this._subscriptions.size>0?this._fireSubscriptions:void 0,recordChangeId:this._recordChangedId,saveDeferredTrack:this._saveDeferredTrack,eventLogger:this._options.eventLogger}}_runAutoExperiment(t,e){const n=this._activeAutoExperiments.get(t);if(t.manual&&!this._triggeredExpKeys.has(t.key)&&!n)return null;let r,i;this._isAutoExperimentBlockedByContext(t)?r=jt(this._getEvalContext(),t,-1,!1,""):(({result:r,trackingCall:i}=It(t,null,this._getEvalContext())),this._fireSubscriptions(t,r));const s=JSON.stringify(r.value);if(!e&&r.inExperiment&&n&&n.valueHash===s)return r;if(n&&this._undoActiveAutoExperiment(t),r.inExperiment){const e=b(t);if("redirect"===e&&r.value.urlRedirect&&t.urlPatterns){const e=t.persistQueryString?function(t,e){let n,r;try{n=new URL(t),r=new URL(e)}catch(t){return console.error(`Unable to merge query strings: ${t}`),e}return n.searchParams.forEach(((t,e)=>{r.searchParams.has(e)||r.searchParams.set(e,t)})),r.toString()}(this._getContextUrl(),r.value.urlRedirect):r.value.urlRedirect;if(d(e,t.urlPatterns))return this.log("Skipping redirect because original URL matches redirect URL",{id:t.key}),r;this._redirectedUrl=e;const{navigate:n,delay:s}=this._getNavigateFunction();if(n)if(zt)Promise.all([...i?[k(i,this._options.maxNavigateDelay??1e3)]:[],new Promise((t=>window.setTimeout(t,this._options.navigateDelay??s)))]).then((()=>{try{n(e)}catch(t){console.error(t)}}));else try{n(e)}catch(t){console.error(t)}}else if("visual"===e){const e=this._options.applyDomChangesCallback?this._options.applyDomChangesCallback(r.value):this._applyDOMChanges(r.value);e&&this._activeAutoExperiments.set(t,{undo:e,valueHash:s})}}return r}_undoActiveAutoExperiment(t){const e=this._activeAutoExperiments.get(t);e&&(e.undo(),this._activeAutoExperiments.delete(t))}_updateAllAutoExperiments(t){if(!this._autoExperimentsAllowed)return;const e=this._options.experiments||[],n=new Set(e);this._activeAutoExperiments.forEach(((t,e)=>{n.has(e)||(t.undo(),this._activeAutoExperiments.delete(e))}));for(const n of e){const e=this._runAutoExperiment(n,t);if(null!=e&&e.inExperiment&&"redirect"===b(n))break}}_fireSubscriptions(t,e){const n=t.key,r=this._assigned.get(n);r&&r.result.inExperiment===e.inExperiment&&r.result.variationId===e.variationId||(this._assigned.set(n,{experiment:t,result:e}),this._subscriptions.forEach((n=>{try{n(t,e)}catch(t){console.error(t)}})))}_recordChangedId(t){this._completedChangeIds.add(t)}isOn(t){return this.evalFeature(t).on}isOff(t){return this.evalFeature(t).off}getFeatureValue(t,e){const n=this.evalFeature(t).value;return null===n?e:n}feature(t){return this.evalFeature(t)}evalFeature(t){return Ft(t,this._getEvalContext())}log(t,e){this.debug&&(this._options.log?this._options.log(t,e):console.log(t,e))}getDeferredTrackingCalls(){return Array.from(this._deferredTrackingCalls.values())}setDeferredTrackingCalls(t){this._deferredTrackingCalls=new Map(t.filter((t=>t&&t.experiment&&t.result)).map((t=>[Gt(t.experiment,t.result),t])))}async fireDeferredTrackingCalls(){if(!this._options.trackingCallback)return;const t=[];this._deferredTrackingCalls.forEach((e=>{e&&e.experiment&&e.result?t.push(this._options.trackingCallback(e.experiment,e.result)):console.error("Invalid deferred tracking call",{call:e})})),this._deferredTrackingCalls.clear(),await Promise.all(t)}setTrackingCallback(t){this._options.trackingCallback=t,this.fireDeferredTrackingCalls()}setEventLogger(t){this._options.eventLogger=t}async logEvent(t,e){if(this._destroyed)console.error("Cannot log event to destroyed GrowthBook instance");else if(this._options.enableDevMode&&this.logs.push({eventName:t,properties:e,timestamp:Date.now().toString(),logType:"event"}),this._options.eventLogger)try{await this._options.eventLogger(t,e||{},this._getUserContext())}catch(t){console.error(t)}else console.error("No event logger configured")}_saveDeferredTrack(t){this._deferredTrackingCalls.set(Gt(t.experiment,t.result),t)}_getContextUrl(){return this._options.url||(zt?window.location.href:"")}_isAutoExperimentBlockedByContext(t){const e=b(t);if("visual"===e){if(this._options.disableVisualExperiments)return!0;if(this._options.disableJsInjection&&t.variations.some((t=>t.js)))return!0}else{if("redirect"!==e)return!0;if(this._options.disableUrlRedirectExperiments)return!0;try{const e=new URL(this._getContextUrl());for(const n of t.variations){if(!n||!n.urlRedirect)continue;const t=new URL(n.urlRedirect);if(this._options.disableCrossOriginUrlRedirectExperiments){if(t.protocol!==e.protocol)return!0;if(t.host!==e.host)return!0}}}catch(e){return this.log("Error parsing current or redirect URL",{id:t.key,error:e}),!0}}return!(!t.changeId||!(this._options.blockedChangeIds||[]).includes(t.changeId))}getRedirectUrl(){return this._redirectedUrl}_getNavigateFunction(){return this._options.navigate?{navigate:this._options.navigate,delay:0}:zt?{navigate:t=>{window.location.replace(t)},delay:100}:{navigate:null,delay:0}}_applyDOMChanges(t){if(!zt)return;const e=[];if(t.css){const n=document.createElement("style");n.innerHTML=t.css,document.head.appendChild(n),e.push((()=>n.remove()))}if(t.js){const n=document.createElement("script");n.innerHTML=t.js,this._options.jsInjectionNonce&&(n.nonce=this._options.jsInjectionNonce),document.head.appendChild(n),e.push((()=>n.remove()))}return t.domMutations&&t.domMutations.forEach((t=>{e.push(At(t).revert)})),()=>{e.forEach((t=>t()))}}async refreshStickyBuckets(t){if(this._options.stickyBucketService){const e=this._getEvalContext(),n=await async function(t,e,n){const r=Pt(t,n);return e.getAllAssignments(r)}(e,this._options.stickyBucketService,t);this._options.stickyBucketAssignmentDocs=n}}generateStickyBucketAssignmentDocsSync(t,e){if(!("getAllAssignmentsSync"in t))return void console.error("generating StickyBucketAssignmentDocs docs requires StickyBucketServiceSync");const n=Pt(this._getEvalContext(),e);return t.getAllAssignmentsSync(n)}inDevMode(){return!!this._options.enableDevMode}}({apiHost:"https://cdn.growthbook.io",clientKey:window.growthbook_sdk_key,decryptionKey:window.growthbook_decrypt_key,enableDevMode:window.growthbook_dev_mode});function Wt(t){const e=window.location.search.substring(1).split("&");let n=null;return e.forEach((e=>{const r=e.split("=");r[0]===t&&(n=decodeURIComponent(r[1].replace(/\+/g,"%20")))})),n}function Xt(){return u()}function Yt(t){return(t||"").split("|").reduce(((t,e)=>{const n=e.split("=");return t[n[0]]=n[1],t}),{})}function te(){return document.cookie.split(";").reduce(((t,e)=>{const n=e.indexOf("="),r=e.substring(0,n).trim(),i=e.substring(n+1).trim();return t[r]=i,t}),{})}Qt.init({streaming:!0}),window.analytics.ready((function(){Qt.setTrackingCallback(((t,e)=>{window.analytics.track("Experiment Viewed",{experimentId:t.key,variationId:e.key})})),Qt.setAttributes(Object.assign(Object.assign({},Qt.getAttributes()),{id:window.analytics.user().anonymousId(),userId:window.analytics.user().id()}))}));export{Xt as a,Yt as b,Wt as g,te as p}